---
title: "expct"
author: "Oisin Ryan"
date: "2022-12-15"
output: 
  md_document:
    variant: gfm
---

# expct

An `R` package to extract dynamic features from regularly/irregularly spaced univariate/multivariate time series.

The package takes a longitudinal dataset as the input. Relying on a simple data-stacking approach and Generalized Additive Mixed Models (GAMMs), it allows researchers to:

  - a) Visualize the dynamic relationship between covariates and outcomes as a function of time-interval, as shown below.
  - b) Estimate the functional form of lagged correlations as a function of the time-interval between measurements.
  - c) Build various Confidence Intervals (CIs) to measure the estimation uncertainty of lagged correlations.
  
## Background
This repository contains an `R` package used by ZZZ (in preperation0) to qqq

## Installation
The current version of this package can be installed directly from github using
```{r,  eval = F}
devtools::install_github("ryanoisin/expct")
```

## Usage
To deploy this package, a longitudinal dataset is taken as the input. The raw data is then stacked to serve for estimating GAMMs. Then, the point estimations of lagged correlations and corresponding CIs can be built.

More specifically, the main function of this package is `CTVEM`. Some important input options of this function are:

  - a) dataset: Specify the longitudinal dataset which contains Time (measurements time) , ID and covariates columns.
  - b) quantiles: The quantiles to build CI, the default value is c(low_quantile, high_quantile) = c(.025, 0.975).
  - c) Tpred: A vector which indicates that interested time points in which we want to estimate correlations, e.g. regularly spaced seq(0,30,1) and iregularly spaced c(1,5,6,9,15).
  - d) output_type: Indicate which output format will be returned. If output_type == "CI", point estimations and corresponding CIs will be returned. If output_type =="PE", only ponit estimation will be returned. If output_type =="SCI", the Simultaneous CIs, which is based on [Link](https://fromthebottomoftheheap.net/2016/12/15/simultaneous-interval-revisited/) will be returned. If output_type =="LLCI", the CIs with large-lag errors will be returned. This type of CIs is based on the [Book](https://books.google.com/books?hl=en&lr=&id=rNt5CgAAQBAJ&oi=fnd&pg=PR7&dq=Time+series+forecasting+and+control&ots=DK80uNo2Wy&sig=qqqwadWjU9h-ZeP9a-lXxpVdb_Q#v=onepage&q=Time%20series%20forecasting%20and%20control&f=false) `Time series analysis: forecasting and control`. The default value is "CI".
  
The output of this functions is a list which contains below elements:

  - a) est: The point estimation of lagged correlations between covariates and outcomes.
  - b) highCI: The uppper CI of the point estimation.
  - c) lowCI: The lower CI of the point estimation.
  - d) laglongreducedummy: The stacked dataset from the raw data.
  - e) attributes: All attributes used to estimate GAMMs.  


### Example

Load data:

```{r}
load("data/simdata.rda")
library(CTVEM)
head(simdata)

```

Peform analyses with `CTVEM`:

```{r}
library(mgcv)
Tpred = seq(1,30,1)

est <- expct(
  dataset = simdata,
  Time = "time",
  outcome = c("Y1","Y2"),
  ID = "id",
  estimate = "marginal",
  Tpred = Tpred,
  plot_show = F,
  quantiles = c(.025, 0.975),
  method = "bam",
)

plot(est$est[[1]], type = "b", ylab = "estimated autoregression", xlab = "time diff", main = "Autoregression X1")
lines(est$highCI[[1]], lty = 2, col = "gray")
lines(est$lowCI[[1]], lty = 2, col = "gray")

plot(est$est[[2]], type = "b", ylab = "estimated autoregression", xlab = "time diff", main = "Cross-Regression X2 on X1")
lines(est$highCI[[2]], lty = 2, col = "gray")
lines(est$lowCI[[2]], lty = 2, col = "gray")
# plot(mcr$est[[2]], type = "b", ylab = "estimated autoregression", xlab = "time diff", main = "Cross-Regresion")
# plot(mcr$est[[3]], type = "b", ylab = "estimated autoregression", xlab = "time diff", main = "Autoregression X1")
# plot(mcr$est[[4]], type = "b", ylab = "estimated autoregression", xlab = "time diff", main = "Autoregression X1")
```


## Contact Details

For more details please contact **o.ryan@uu.nl**
